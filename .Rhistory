dplyr::select_if(is.factor) %>%
mutate_all(droplevels) -> df1
df1[[group]] %>%
levels -> levels
df1[[group]] %>% summary -> number_groups
df1[, !names(df1) %in% c(omit, group)] -> df2
lapply(1:ncol(df2), function(i){
df1[[colnames(df2)[i]]] %>%
levels -> factor
df2[, colnames(df2)[i]] %>%
bind_cols(df1[, group]) %>%
table -> table
table -> table2
table2[1,1] <- table[1,1]+0.5
table2[1,2] <- table[1,2]+0.5
table2[2,1] <- table[2,1]+0.5
table2[2,2] <- table[2,2]+0.5
data.frame(
Variable = colnames(df2)[i],
Factor = factor[1],
Number1 = table[1, 1],
Ratio1 =  table[1, 1]/sum(table[,1]),
Number2 = table[1, 2],
Ratio2 =  table[1, 2]/sum(table[,2]),
P.value = fisher.test(table)$p.value,
OR = fisher.test(table2)$estimate,
CI_Low = fisher.test(table2)$conf.int[1],
CI_High = fisher.test(table2)$conf.int[2])
}) %>%
do.call(bind_rows, .) %>%
mutate(SD = ifelse(P.value < 0.001, paste("***"),
ifelse(P.value < 0.01,paste("**"),
ifelse(P.value < 0.05,paste("*"),
paste(""))))) %>%
mutate(Variable1 = paste0(Number1, " (",
sprintf(Ratio1*100, fmt = '%#.1f'), "%)" )) %>%
mutate(Variable2 = paste0(Number2, " (",
sprintf(Ratio2*100, fmt = '%#.1f'), "%)" )) %>%
mutate(Variable = paste0(Variable, " [", Factor, "]")) %>%
mutate(`Odds ratio [95% CI]` = paste0(sprintf(OR, fmt = fmt),
" [",
sprintf(CI_Low, fmt = fmt),
" – ",
sprintf(CI_High, fmt = fmt),
"]")) %>%
dplyr::select(Variable, Variable1, Variable2,
`Odds ratio [95% CI]`, P.value, SD) %>%
mutate_if(is.character, as.factor) -> result
colnames(result)[2] <- paste0(levels[1], " (N = ", number_groups[1], ")")
colnames(result)[3] <- paste0(levels[2], " (N = ", number_groups[2], ")")
result %>% tibble::as_tibble()
}
Data_tbw %>%
dplyr::select(!is.numeric, -合併症) %>%
fisher_CI_table2(.,
group = "導尿困難",
digits = 1,
omit = "症例")
table2
table2[1,1] <- table[1,1]+0.5
table2[1,2] <- table[1,2]+0.5
table2[2,1] <- table[2,1]+0.5
table2[2,2] <- table[2,2]+0.5
table2
fisher.test(table2)$estimate
fisher.test(table2)$estimate
fisher.test(table2)$conf.int[1]
fisher.test(table2)$conf.int[2]
factor
levels
Data_tbw
i=5
i=4
colnames(df2)
i=5
df1[[colnames(df2)[i]]] %>%
levels -> factor
df2[, colnames(df2)[i]] %>%
bind_cols(df1[, group]) %>%
table -> table
table
table -> table2
table2[1,1] <- table[1,1]+0.5
table2[1,2] <- table[1,2]+0.5
table2[2,1] <- table[2,1]+0.5
table2[2,2] <- table[2,2]+0.5
table2
fisher.test(table2)$estimate
table2
fisher.test(table2)$estimate
table -> table2
table2[1,1] <- table[1,1]+1
table2[1,2] <- table[1,2]+1
table2[2,1] <- table[2,1]+1
table2[2,2] <- table[2,2]+1
fisher.test(table2)$estimate
fisher.test(table2)$conf.int[1]
fisher.test(table2)$conf.int[2]
install.packages("PropCIs")
library(PropCIs)
df
table(c(1,1,3,2)) -> df
fisher.test(df)
table(c(1,1,3,2))
fisher.test(table)
table
fisher.test(table)
orscoreci(100, 0, 200, 100,
0.95)
orscoreci(100, 100, 200, 300,
0.95)
orscoreci(100, 100, 200, 200,
0.95)
orscoreci(100, 100, 200, 300,
0.95)
orscoreci(100, 140, 200, 300,
0.95)
orscoreci(100, 200, 200, 300,
0.95)
orscoreci(100, 100, 200, 300,
0.95)
orscoreci(0, 100, 200, 300,
0.95)
install.packages("epitools")
library(epitools)
oddsratio(table)
table
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
arrange(Variable)
oddsratio(table,
oddsratio(table,
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
oddsratio(table,
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
oddsratio(table,
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
oddsratio(t(table),
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
df
oddsratio(df,
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
oddsratio(df,
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
tapw <- c("Lowest", "Intermediate", "Highest")
outc <- c("Case", "Control")
dat <- matrix(c(2, 29, 35, 64, 12, 6),3,2,byrow=TRUE)
dimnames(dat) <- list("Tap water exposure" = tapw, "Outcome" = outc)
oddsratio(dat, rev="c")
dat
dat <- matrix(c(2, 29, 0, 64, 12, 6),3,2,byrow=TRUE)
dimnames(dat) <- list("Tap water exposure" = tapw, "Outcome" = outc)
oddsratio(dat, rev="c")
dat <- matrix(c(2, 29, 0, 64, 12, 6),3,2,byrow=TRUE)
oddsratio(dat, rev="c")
oddsratio.midp(dat, rev="c")
oddsratio.fisher(dat, rev="c")
oddsratio.wald(dat, rev="c")
oddsratio.wald(dat, rev="c")
oddsratio.small(dat, rev="c")
oddsratio.wald(table,
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
oddsratio.wald(table,
y = NULL,
method = c("midp", "fisher", "wald", "small"),
conf.level = 0.95,
rev = c("neither", "rows", "columns", "both"),
correction = FALSE,
verbose = FALSE)
oddsratio.wald(table, rev="c")
oddsratio.wald(table,
rev="c",
conf.level)
oddsratio.wald(table,
rev="c",
conf.level = 0.95)
oddsratio.wald(table,
rev="c",
verbose = TRUE,
conf.level = 0.95)
oddsratio.small(table,
rev="c",
verbose = TRUE,
conf.level = 0.95)
oddsratio.wald(table,
rev="c",
verbose = TRUE,
conf.level = 0.95)
oddsratio.small(table,
rev="c",
verbose = TRUE,
conf.level = 0.95)
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
arrange(Variable)
mx = matrix(c(2, 10, 0, 4),
nrow = 2,
byrow = T)
fisher.test(mx,
B = 100) %>%
.$estimate
oddsratio.small(table,
rev="c",
verbose = TRUE,
conf.level = 0.95)
Data_tbw %>%
dplyr::select(is.numeric, 導尿困難) %>%
wilcox_CI_table(.,
group = "導尿困難",
digits = 1)
Data_tbw %>%
dplyr::select(!is.numeric, -合併症) %>%
fisher_CI_table(.,
group = "導尿困難",
digits = 1,
omit = "症例")
Data_tbw %>%
dplyr::select(is.numeric, 導尿困難) %>%
wilcox_CI_table(.,
group = "導尿困難",
digits = 1)
omit = c("症例", "合併症")
Data_tbw %>%
dplyr::select(is.numeric, 導尿困難) %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症"))
Data_tbw %>%
dplyr::select(is.numeric, 導尿困難) %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症"))
Data_tbw %>%
dplyr::select(is.numeric, 導尿困難) %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症"))
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症"))
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難"))
女性
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) -> WF_Complication_tbw
inner_join(WF_Complication_tbw, WF_Stenosis_tbw)
WF_Complication_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::renmae(`p-value1`  = P.value) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::renmae(`p-value1` = P.value) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value1` = P.value) -> WF_Stenosis_tbw
WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value1` = P.value) %>%
dplyr::select(-SD) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
dplyr::rename(`p-value2` = P.value) %>%
dplyr::select(-SD)  -> WF_Complication_tbw
inner_join(WF_Complication_tbw, WF_Stenosis_tbw)
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value2` = P.value) %>%
dplyr::select(-SD) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
dplyr::rename(`p-value1` = P.value) %>%
dplyr::select(-SD)  -> WF_Complication_tbw
inner_join(WF_Complication_tbw, WF_Stenosis_tbw)
inner_join(WF_Complication_tbw, WF_Stenosis_tbw) %>%
.[c(7,4,2,10,9,5,11,3,1,6), ]
inner_join(WF_Complication_tbw, WF_Stenosis_tbw) %>%
.[c(7,4,2,10,9,11,3,1,6), ]
source('~/Git/R/CUD_Test.R', echo=TRUE)
inner_join(WF_Complication_tbw, WF_Stenosis_tbw) %>%
.[c(7,4,2,10,9,11,3,1,6), ] %>%
sjPlot::tab_df(.,
file = "CUD/Table.doc")
sessionInfo()
read_excel("/Users/shibataryohei/Dropbox/Database/CUD/ACHMC_Mitrofanoff_Monti.xlsx",
sheet = "Paper2") %>%
dplyr::select(!matches("詳細")) %>%
dplyr::select(-ID, -RandomID, -手術日, -Flap) %>%
mutate(症例 = as.factor(症例)) %>%
mutate_if(is.character, as.factor) %>%
mutate(合併症 = fct_recode(合併症,
"合併症あり" = "あり",
"合併症なし" = "なし")) %>%
mutate(導尿困難 = fct_recode(導尿困難,
"導尿困難あり" = "あり",
"導尿困難なし" = "なし")) %>%
mutate(性別 = fct_relevel(性別, "女性"),
脊髄異常 = fct_relevel(脊髄異常, "あり"),
移動 = fct_relevel(移動, "車椅子"))   -> Data_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value2` = P.value) %>%
dplyr::select(-SD) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
dplyr::rename(`p-value1` = P.value) %>%
dplyr::select(-SD)  -> WF_Complication_tbw
WF_Complication_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value2` = P.value) %>%
dplyr::select(-SD) -> WF_Stenosis_tbw
WF_Stenosis_tbw
read_excel("/Users/shibataryohei/Dropbox/Database/CUD/ACHMC_Mitrofanoff_Monti.xlsx",
sheet = "Paper2") %>%
dplyr::select(!matches("詳細")) %>%
dplyr::select(-ID, -RandomID, -手術日) %>%
mutate(症例 = as.factor(症例)) %>%
mutate_if(is.character, as.factor) %>%
mutate(合併症 = fct_recode(合併症,
"合併症あり" = "あり",
"合併症なし" = "なし")) %>%
mutate(導尿困難 = fct_recode(導尿困難,
"導尿困難あり" = "あり",
"導尿困難なし" = "なし")) %>%
mutate(性別 = fct_relevel(性別, "女性"),
脊髄異常 = fct_relevel(脊髄異常, "あり"),
移動 = fct_relevel(移動, "車椅子"))   -> Data_tbw
library(tidyverse)
library(readxl)
source("/Users/shibataryohei/Git/bgstats/bgstats.R")
read_excel("/Users/shibataryohei/Dropbox/Database/CUD/ACHMC_Mitrofanoff_Monti.xlsx",
sheet = "Paper2") %>%
dplyr::select(!matches("詳細")) %>%
dplyr::select(-ID, -RandomID, -手術日) %>%
mutate(症例 = as.factor(症例)) %>%
mutate_if(is.character, as.factor) %>%
mutate(合併症 = fct_recode(合併症,
"合併症あり" = "あり",
"合併症なし" = "なし")) %>%
mutate(導尿困難 = fct_recode(導尿困難,
"導尿困難あり" = "あり",
"導尿困難なし" = "なし")) %>%
mutate(性別 = fct_relevel(性別, "女性"),
脊髄異常 = fct_relevel(脊髄異常, "あり"),
移動 = fct_relevel(移動, "車椅子"))   -> Data_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value2` = P.value) %>%
dplyr::select(-SD) -> WF_Stenosis_tbw
inner_join(WF_Complication_tbw, WF_Stenosis_tbw) %>%
.[c(7,4,2,10,9,11,3,1,6), ] %>%
sjPlot::tab_df(.,
file = "CUD/Table.doc")
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
dplyr::rename(`p-value1` = P.value) %>%
dplyr::select(-SD)  -> WF_Complication_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value2` = P.value) %>%
dplyr::select(-SD) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
dplyr::rename(`p-value1` = P.value) %>%
dplyr::select(-SD)  -> WF_Complication_tbw
inner_join(WF_Complication_tbw, WF_Stenosis_tbw)
WF_Stenosis_tbw
WF_Complication_tbw
WF_Stenosis_tbw
read_excel("/Users/shibataryohei/Dropbox/Database/CUD/ACHMC_Mitrofanoff_Monti.xlsx",
sheet = "Paper2") %>%
dplyr::select(!matches("詳細")) %>%
dplyr::select(-ID, -RandomID, -手術日) %>%
mutate(症例 = as.factor(症例)) %>%
mutate_if(is.character, as.factor) %>%
mutate(合併症 = fct_recode(合併症,
"合併症あり" = "あり",
"合併症なし" = "なし")) %>%
mutate(導尿困難 = fct_recode(導尿困難,
"導尿困難あり" = "あり",
"導尿困難なし" = "なし")) %>%
mutate(性別 = fct_relevel(性別, "女性"),
脊髄異常 = fct_relevel(脊髄異常, "あり"),
移動 = fct_relevel(移動, "車椅子"),
Flap = fct_relevel(Flap, "VR"))   -> Data_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "導尿困難",
digits = 1,
omit = c("症例", "合併症")) %>%
dplyr::rename(`p-value2` = P.value) %>%
dplyr::select(-SD) -> WF_Stenosis_tbw
Data_tbw %>%
wilcox_fisher_table(.,
group = "合併症",
digits = 1,
omit = c("症例", "導尿困難")) %>%
dplyr::rename(`p-value1` = P.value) %>%
dplyr::select(-SD)  -> WF_Complication_tbw
WF_Stenosis_tbw
Data_tbw
Data_tbw %>%
median_percent_table
Data_tbw
Data_tbw %>%
median_percent_table(.,
omit = "症例")
Data_tbw %>%
median_percent_table(.,
omit = "症例",
digits = 1)
